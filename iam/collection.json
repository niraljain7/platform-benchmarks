{
  "info": {
    "_postman_id": "db990227-f87b-4cab-ba34-14bd3f84d72d",
    "name": "NslIam",
    "schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
  },
  "item": [
    {
      "name": "Login as usercco Copy",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "d786114f-c23d-4ad6-b352-125919413d16",
            "exec": [
              "pm.test(\"Check status code\", function(){\r",
              "    pm.expect(pm.response.code).to.eq(200);\r",
              "});\r",
              "\r",
              "pm.environment.set('BearerToken',pm.response.json().result.token_type+\" \"+pm.response.json().result.access_token);\r",
              "pm.environment.set('RefreshToken',pm.response.json()[\"result\"][\"refresh_token\"]);"
            ],
            "type": "text/javascript"
          }
        },
        {
          "listen": "prerequest",
          "script": {
            "id": "f9654ac9-3d59-47c7-a1a6-c31325067393",
            "exec": [
              ""
            ],
            "type": "text/javascript"
          }
        }
      ],
      "_postman_id": "8086f6f3-7ff3-4e8c-99b8-96e05a06715a",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Accept",
            "value": "application/json, text/plain, */*"
          },
          {
            "key": "Content-Type",
            "value": "application/json"
          },
          {
            "key": "Accept-Language",
            "type": "text",
            "value": "en"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n    \"userName\": \"{{UserCCO}}\",\n    \"encryptedPassword\": \"J8JAIlEDnLvsHzljoQJ4VcWCdcVNJTYzWlc7yZaTRcH5roLNs6trxwD+Ax/XCy3UvJzxSDNLVaa2a7YVcVddeHC6oXuFMf0pNxYWTGi4Tl+ha36Y0DPd4VBFeqvRfDvB2UnUSR+vfIJ56c8SNe0E644yjrCwxXWqAE2B0jTQgfA=\",\n    \"tenantName\": \"{{TenantName}}\",\n    \"clientId\": \"{{TenantName}}\"\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": "https://{{TenantName}}.{{BaseURL}}/dsd-orch/nsl-iam/api/login/v2/login-action"
      },
      "response": []
    },
    {
      "name": "Get All Users Info - UserName Copy",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Check status code\", function(){\r",
              "    pm.expect(pm.response.code).to.eq(200);\r",
              "\r",
              "\r",
              "    const users  = pm.response.json().content;\r",
              "\r",
              "    let isFound = false;\r",
              "\r",
              "    users.forEach((userName)=> {\r",
              "        if(userName.name == pm.variables.get(\"UserName\")) {\r",
              "            isFound = true;\r",
              "            // pm.expect(userName.name).to.eq(pm.environment.get(\"UserCCO1\"));\r",
              "            // pm.expect(userName.id).to.eq(parseInt(pm.environment.get(\"UserCCO1Id\")));\r",
              "\r",
              "            let json = userName;\r",
              "            userName.roles = [];\r",
              "            pm.variables.set(\"UserNameDetails\",JSON.stringify(json));\r",
              "        }\r",
              "    });\r",
              "\r",
              "    pm.expect(isFound).to.eq(true)\r",
              "});"
            ],
            "type": "text/javascript",
            "id": "7cc9af3c-6d06-496f-bfcf-ea98c88a585c"
          }
        }
      ],
      "_postman_id": "0436a43d-5901-49eb-ac9a-101f02d2326c",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "{{BearerToken}}",
            "type": "text"
          },
          {
            "key": "Accept-Language",
            "value": "en",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{}",
          "options": {}
        },
        "url": {
          "raw": "https://{{TenantName}}.{{BaseURL}}/dsd-orch/nsl-iam/api/user/getAllUsersBySearchTerm?pageNumber=0&pageSize=5&searchTerm={{UserName}}&isActive=false",
          "protocol": "https",
          "host": [
            "{{TenantName}}",
            "{{BaseURL}}"
          ],
          "path": [
            "dsd-orch",
            "nsl-iam",
            "api",
            "user",
            "getAllUsersBySearchTerm"
          ],
          "query": [
            {
              "key": "pageNumber",
              "value": "0"
            },
            {
              "key": "pageSize",
              "value": "5"
            },
            {
              "key": "searchTerm",
              "value": "{{UserName}}"
            },
            {
              "key": "isActive",
              "value": "false"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "Verify IRDR for shared role Copy",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "364fbd85-6875-47d3-b2e6-fe67731515f1",
            "exec": [
              "pm.test(\"Check status code\", function(){\r",
              "    pm.expect(pm.response.code).to.eq(200);\r",
              "});\r",
              "pm.test(\"Check response\", function(){\r",
              "    pm.expect(parseInt(pm.response.json().bookId)).to.eq(pm.variables.get(\"BookId\"));\r",
              "    pm.expect(pm.response.json().bookName).to.eq(pm.variables.get(\"BookName\"));\r",
              "    pm.expect(parseInt(pm.response.json().solDtos[0].gsiId)).to.eq(pm.variables.get(\"SolutionId\"));\r",
              "    pm.expect(pm.response.json().solDtos[0].gsiName).to.eq(pm.variables.get(\"SolutionName\"));\r",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "_postman_id": "8c9f36b8-9ab5-427d-b952-100ada1ae40f",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": {}
        },
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "{{BearerToken}}",
            "type": "text"
          },
          {
            "key": "Accept-Language",
            "value": "en",
            "type": "text"
          },
          {
            "key": "Content-Type",
            "value": "application/json",
            "type": "text"
          }
        ],
        "url": {
          "raw": "https://{{TenantName}}.{{BaseURL}}/dsd-orch/nsl-iam/api/roles/getBookTreeById?id={{BookId}}&roleId={{RoleId}}&searchCriteria=",
          "protocol": "https",
          "host": [
            "{{TenantName}}",
            "{{BaseURL}}"
          ],
          "path": [
            "dsd-orch",
            "nsl-iam",
            "api",
            "roles",
            "getBookTreeById"
          ],
          "query": [
            {
              "key": "id",
              "value": "{{BookId}}"
            },
            {
              "key": "roleId",
              "value": "{{RoleId}}"
            },
            {
              "key": "searchCriteria",
              "value": ""
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "Fetch by username Copy",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {\r",
              "    pm.response.to.have.status(200);\r",
              "    //pm.variables.set('UserId1',pm.response.json().content[0].id);\r",
              "    \r",
              "});"
            ],
            "type": "text/javascript",
            "id": "2553f9a3-e7fa-4f8d-8687-c1b6fc73cc34"
          }
        }
      ],
      "_postman_id": "3de95701-8af4-4c03-a904-15235b3b7a19",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "{{BearerToken}}",
            "type": "text"
          },
          {
            "key": "Accept-Language",
            "value": "en",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "https://{{TenantName}}.{{BaseURL}}/dsd-orch/nsl-iam/api/user/getAllUsersBySearchTerm?pageNumber=0&pageSize=10&searchTerm={{UserName}}&isActive=false",
          "protocol": "https",
          "host": [
            "{{TenantName}}",
            "{{BaseURL}}"
          ],
          "path": [
            "dsd-orch",
            "nsl-iam",
            "api",
            "user",
            "getAllUsersBySearchTerm"
          ],
          "query": [
            {
              "key": "pageNumber",
              "value": "0"
            },
            {
              "key": "pageSize",
              "value": "10"
            },
            {
              "key": "searchTerm",
              "value": "{{UserName}}"
            },
            {
              "key": "isActive",
              "value": "false"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "Create Shared Role Copy",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Check status code\", function(){\r",
              "    pm.expect(pm.response.code).to.eq(200);\r",
              "});\r",
              "pm.test(\"Check response\", function(){\r",
              "    pm.expect(pm.response.json().message).to.eq(\"Role created successfully\");\r",
              "})\r",
              ""
            ],
            "type": "text/javascript",
            "id": "9c5a4640-79d0-4e7d-ad7d-95eb07c1540a"
          }
        }
      ],
      "_postman_id": "63d8a44f-1f70-4774-a497-95920219bf2f",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "{{BearerToken}}",
            "type": "text"
          },
          {
            "key": "Accept-Language",
            "value": "en",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\r\n    \"name\": \"{{SharedRole}}\",\r\n    \"users\": [\r\n        {{UserNameDetails}}\r\n    ],\r\n    \"groups\": [],\r\n    \"isAdmin\": false,\r\n    \"description\": \"\",\r\n    \"isEnabled\": false\r\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "https://{{TenantName}}.{{BaseURL}}/dsd-orch/nsl-iam/api/roles/createRoleAndAttachToBooks?bklist={{BookId}}",
          "protocol": "https",
          "host": [
            "{{TenantName}}",
            "{{BaseURL}}"
          ],
          "path": [
            "dsd-orch",
            "nsl-iam",
            "api",
            "roles",
            "createRoleAndAttachToBooks"
          ],
          "query": [
            {
              "key": "bklist",
              "value": "{{BookId}}"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "View Shared Role Copy",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Check status code\", function(){\r",
              "    pm.expect(pm.response.code).to.eq(200);\r",
              "});\r",
              "pm.test(\"Check response\", function(){\r",
              "    //check the if the list of roles has at least one role that we have just created\r",
              "    pm.expect(pm.response.json().rolesList[0].name).to.eq(pm.variables.get(\"SharedRole\"));\r",
              "    pm.expect(pm.response.json().rolesList[0].isEnabled).to.eq(false);\r",
              "\r",
              "    pm.variables.set(\"RoleId\",pm.response.json().rolesList[0].id)\r",
              "    pm.variables.set(\"CreatedAt\",pm.response.json().rolesList[0].createdAt)\r",
              "    pm.variables.set(\"UpdatedAt\",pm.response.json().rolesList[0].updatedAt)\r",
              "    pm.variables.set(\"TagId\",pm.response.json().rolesList[0].tagId)\r",
              "\r",
              "});"
            ],
            "type": "text/javascript",
            "id": "d58bf158-268d-4fed-8ab8-d59281c0c010"
          }
        }
      ],
      "_postman_id": "220bd251-fa6a-4efd-93c4-c8df6cf1776d",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "{{BearerToken}}",
            "type": "text"
          },
          {
            "key": "Accept-Language",
            "value": "en",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\r\n    \"isActive\": false,\r\n    \"roleName\": \"{{SharedRole}}\"\r\n}",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": {
          "raw": "https://{{TenantName}}.{{BaseURL}}/dsd-orch/nsl-iam/api/roles/getB2cRoles?pageNumber=0&pageSize=10",
          "protocol": "https",
          "host": [
            "{{TenantName}}",
            "{{BaseURL}}"
          ],
          "path": [
            "dsd-orch",
            "nsl-iam",
            "api",
            "roles",
            "getB2cRoles"
          ],
          "query": [
            {
              "key": "pageNumber",
              "value": "0"
            },
            {
              "key": "pageSize",
              "value": "10"
            }
          ]
        }
      },
      "response": []
    },
    {
      "name": "Save IRDR Copy",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Check status code\", function(){\r",
              "    pm.expect(pm.response.code).to.eq(200);\r",
              "});\r",
              "pm.test(\"Check response\", function(){\r",
              "    pm.expect(pm.response.json().message).to.eq(\"IRDRs Successfully Saved\");\r",
              "})"
            ],
            "type": "text/javascript",
            "id": "2acb4d36-0023-4d47-b542-b5164c04066e"
          }
        }
      ],
      "_postman_id": "7e81a9a5-064a-45b0-bfd3-d825a139cbf8",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Authorization",
            "value": "{{BearerToken}}",
            "type": "text"
          },
          {
            "key": "Accept-Language",
            "value": "en",
            "type": "text"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "[\r\n    {\r\n        \"bookId\": {{BookId}},\r\n        \"design\": true,\r\n        \"gsiId\": \"{{SolutionId}}\",\r\n        \"irdr\": {\r\n            \"decisionRight\": true,\r\n            \"disableParentRoleAccess\": false,\r\n            \"executionRight\": false,\r\n            \"informationRight\": true,\r\n            \"rightHolderId\": {{CCORoleId}},\r\n            \"rightHolderType\": \"ROLE\"\r\n        }\r\n    },\r\n    {\r\n        \"bookId\": {{BookId}},\r\n        \"design\": false,\r\n        \"gsiId\": \"{{SolutionId}}\",\r\n        \"irdr\": {\r\n            \"decisionRight\": false,\r\n            \"disableParentRoleAccess\": false,\r\n            \"executionRight\": true,\r\n            \"informationRight\": true,\r\n            \"rightHolderId\": {{CCORoleId}},\r\n            \"rightHolderType\": \"ROLE\"\r\n        }\r\n    }\r\n]",
          "options": {
            "raw": {
              "language": "json"
            }
          }
        },
        "url": "https://{{TenantName}}.{{BaseURL}}/dsd-orch/nsl-iam/api/user/saveIRDRs"
      },
      "response": []
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "let json = {",
          "            \"id\": 2148143410395,",
          "            \"createdAt\": 1650951442555,",
          "            \"updatedAt\": 1650951442555,",
          "            \"orgUnitId\": 1048774332110,",
          "            \"name\": \"Amandeep.goyal@nslhub.com\",",
          "            \"email\": \"Amandeep.goyal@nslhub.com\",",
          "            \"mobileNumber\": \"7019356279\",",
          "            \"isEnabled\": true,",
          "            \"roles\": [",
          "                {",
          "                    \"id\": 1118115121063,",
          "                    \"createdAt\": 1649163005001,",
          "                    \"updatedAt\": 1652095461019,",
          "                    \"name\": \" Employee\",",
          "                    \"description\": \"\",",
          "                    \"isEnabled\": true,",
          "                    \"isAdmin\": false,",
          "                    \"tagId\": 1892314879594,",
          "                    \"roleType\": \"LOCAL\"",
          "                }",
          "            ],",
          "            \"groups\": [],",
          "            \"customID\": \"28246\",",
          "            \"autoCustomID\": \"28246\"",
          "        }",
          "pm.variables.set(\"UserNameDetails\", JSON.stringify(json))",
          "let bookId = 1421739491964",
          "pm.variables.set(\"BookId\",bookId)",
          "let solutionId = 1007437723886",
          "pm.variables.set(\"SolutionId\",solutionId)"
        ],
        "id": "82230b2b-8722-4f12-a5e8-16c8471f6136"
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          ""
        ],
        "id": "93f7cd4b-2c81-437e-9896-bd3ea5aade26"
      }
    }
  ],
  "variable": [
    {
      "id": "8db629aa-c846-482d-a18b-ec576bfc43c9",
      "key": "UserName",
      "value": "Amandeep.goyal@nslhub.com",
      "type": "string"
    },
    {
      "id": "ac2de691-9796-4c36-951c-bd705ee8ff08",
      "key": "BookId",
      "value": "1421739491964",
      "type": "string",
      "disabled": true
    },
    {
      "id": "9d6d2bc9-1886-4d3b-badf-e7d4474cb0fd",
      "key": "RoleId",
      "value": "",
      "type": "string"
    },
    {
      "id": "a4d3261a-7144-4020-9e82-adff48b15093",
      "key": "SharedRole",
      "value": "Random",
      "type": "string"
    },
    {
      "id": "df2ddccc-0a21-41c4-a8e9-20fdb3c2a68c",
      "key": "UserNameDetails",
      "value": "\" {\n            \"id\": 2148143410395,\n            \"createdAt\": 1650951442555,\n            \"updatedAt\": 1650951442555,\n            \"orgUnitId\": 1048774332110,\n            \"name\": \"Amandeep.goyal@nslhub.com\",\n            \"email\": \"Amandeep.goyal@nslhub.com\",\n            \"mobileNumber\": \"7019356279\",\n            \"isEnabled\": true,\n            \"roles\": [\n                {\n                    \"id\": 1118115121063,\n                    \"createdAt\": 1649163005001,\n                    \"updatedAt\": 1652095461019,\n                    \"name\": \" Employee\",\n                    \"description\": \"\",\n                    \"isEnabled\": true,\n                    \"isAdmin\": false,\n                    \"tagId\": 1892314879594,\n                    \"roleType\": \"LOCAL\"\n                }\n            ],\n            \"groups\": [],\n            \"customID\": \"28246\",\n            \"autoCustomID\": \"28246\"\n        }\"",
      "type": "string"
    },
    {
      "id": "83d1b8ef-2e8c-4bca-9f20-cb81c54326a8",
      "key": "BookName",
      "value": "BasicBook2022050910595455210",
      "type": "string"
    },
    {
      "id": "c9fd1c7a-0b19-48bf-a20d-209671e63b6a",
      "key": "SolutionName",
      "value": "BasicSolution2022050910595455210",
      "type": "string"
    }
  ]
}